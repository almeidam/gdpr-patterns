{{ if  eq (printf "%T" .Params) "map[string]string"         }}
    {{ .Scratch.Set "height" .Params.height                 }}
    {{ .Scratch.Set "autorun" .Params.autorun               }}
{{ end}}

{{ $height    := default 35    (.Scratch.Get "height") }}
{{ $autorun   := default "yes" (.Scratch.Get "autorun") }}
{{ $code_div  := (printf "repl_%d" (index (seq 1000 | shuffle) 0) ) }}
{{ $query     := (trim .Inner "\n")}}

<style>
    #textarea_{{safeJS $code_div}} {
        border-radius: .8rem;
        height: {{safeJS $height}}px;
        margin-left: 15px;
    }
    #cypher-query button {
        border-radius: .8rem;
        margin-right: 15px;
        margin-left: 15px;
    }
    .alert {
        border-radius: .8rem;
        margin-right: 15px;
        margin-left: 15px;
    }
</style>

<div class="form-group row" id="cypher-query">
    <div class="col-md-12">
        <div class="input-group">
            <textarea id="textarea_{{safeJS $code_div}}"
                      class="form-control">{{ $query }}</textarea>

            <span class="input-group-append">
                <button type="button"
                        class="btn btn-primary"
                        onClick="run_Query_{{safeJS $code_div}}()">
                            <i class="fa fa-search"></i>
                    Run Cypher
                </button>
            </span>
        </div>
    </div>
</div>
<div id="cypher-error-alert" class="alert alert-danger" role="alert" style="display:none">
    <strong>Cypher Error!</strong>
    <br><span id="cypher-error-text"></span>
</div>

<script>
    function run_Query_{{safeJS $code_div}}() {
        cypher = $('#textarea_{{safeJS $code_div}}').val()
        neo.run_query(cypher)
    }
    function afterLoad() {
        if ('{{$autorun}}'==='yes')             // once there is one, all will be afected
            run_Query_{{safeJS $code_div}}()
    }

    // set it up so that the query is run on Cmd+Enter or Cmd+s
    jQuery(document).keydown(function(event) {
            if((event.ctrlKey || event.metaKey) && (event.which == 13 ||  event.which == 83)) {
                run_Query_{{safeJS $code_div}}()
                event.preventDefault();
                return false;
            }
        }
    );
</script>